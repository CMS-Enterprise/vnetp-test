<app-tier-select></app-tier-select>

<h1 *ngIf="navIndex === 0">Subnets</h1>

<h1 *ngIf="navIndex === 1">Vlans</h1>

<ng-container *ngIf="currentTier; else warningMessage">
  <app-tabs [tabs]="tabs" (tabChange)="handleTabChange($event)"></app-tabs>

  <div *ngIf="navIndex === 0">
    <section class="btn-toolbar" role="toolbar">
      <!-- Create Subnet -->
      <button type="button" class="btn btn-success" (click)="openSubnetModal(ModalMode.Create)">
        <fa-icon class="icon" [icon]="['fas', 'plus']"></fa-icon>
        <span>Create Subnet</span>
      </button>
    </section>

    <ng-container *ngIf="!isLoadingSubnets; else loading">
      <app-table
        [config]="subnetConfig"
        [data]="subnets"
        (clearResults)="getSubnets($event)"
        (searchParams)="getSubnets($event)"
        [searchColumns]="subnetSearchColumns"
        [(itemsPerPage)]="perPage"
        (tableEvent)="onSubnetTableEvent($event)"
      ></app-table>
      <section class="btn-toolbar" role="toolbar">
        <app-import-export
          [exportObject]="subnets"
          exportFileName="subnets-{{ currentTier?.name }}"
          [disableJson]="false"
          (import)="importSubnetConfig($event)"
        ></app-import-export>
      </section>
    </ng-container>

    <ng-template #vlanIdTemplate let-subnet="datum">
      <section>
        <span>{{ subnet?.vlan?.name }}</span>
      </section>
    </ng-template>

    <ng-template #subnetStateTemplate let-subnet="datum">
      <section>
        <span>{{ subnet.provisionedAt ? 'Provisioned' : 'Not Provisioned' }}</span>
      </section>
    </ng-template>

    <ng-template #actionsTemplate let-subnet="datum">
      <section class="table__actions">
        <app-icon-button
          *ngIf="checkUndeployedChanges(subnet)"
          icon="asterisk"
          label="Undeployed Changes"
          [type]="'info'"
        ></app-icon-button>

        <app-icon-button
          *ngIf="!subnet?.deletedAt"
          icon="edit"
          label="Edit Subnet"
          (handleClick)="openSubnetModal(ModalMode.Edit, subnet)"
        ></app-icon-button>

        <app-icon-button
          *ngIf="subnet?.deletedAt"
          icon="undo"
          label="Restore Subnet"
          type="success"
          (handleClick)="restoreSubnet(subnet)"
        ></app-icon-button>

        <app-icon-button
          icon="delete"
          id="softDeleteSubnet"
          label="Soft-Delete/Delete Subnet"
          [type]="subnet?.deletedAt ? 'danger' : 'default'"
          (handleClick)="deleteSubnet(subnet)"
        ></app-icon-button>
      </section>
    </ng-template>
  </div>

  <div *ngIf="navIndex === 1">
    <section class="btn-toolbar" role="toolbar">
      <!-- Create VLAN -->
      <button type="button" class="btn btn-success" (click)="openVlanModal(ModalMode.Create)">
        <fa-icon class="icon" [icon]="['fas', 'plus']"></fa-icon>
        <span>Create VLAN</span>
      </button>
    </section>

    <ng-container *ngIf="!isLoadingVlans; else loading">
      <app-table
        [config]="vlanConfig"
        [data]="vlans"
        (clearResults)="getVlans(false, $event)"
        (searchParams)="getVlans(false, $event)"
        [(itemsPerPage)]="perPage"
        [searchColumns]="vlanSearchColumns"
        (tableEvent)="onVlanTableEvent($event)"
      ></app-table>
      <section class="btn-toolbar" role="toolbar">
        <app-import-export
          [exportObject]="vlans"
          exportFileName="vlans-{{ currentTier?.name }}"
          [disableJson]="false"
          (import)="importVlansConfig($event)"
        ></app-import-export>
      </section>
    </ng-container>

    <ng-template #vlanStateTemplate let-vlan="datum">
      <section>
        <span>{{ vlan.provisionedAt ? 'Provisioned' : 'Not Provisioned' }}</span>
      </section>
    </ng-template>

    <ng-template #actionsTemplate let-vlan="datum">
      <section class="table__actions">
        <app-icon-button *ngIf="checkUndeployedChanges(vlan)" icon="asterisk" label="Undeployed Changes" [type]="'info'"></app-icon-button>

        <app-icon-button
          *ngIf="!vlan?.deletedAt"
          icon="edit"
          label="Edit Vlan"
          (handleClick)="openVlanModal(ModalMode.Edit, vlan)"
        ></app-icon-button>

        <app-icon-button
          *ngIf="vlan?.deletedAt"
          icon="undo"
          label="Restore Vlan"
          type="success"
          (handleClick)="restoreVlan(vlan)"
        ></app-icon-button>

        <app-icon-button
          icon="delete"
          label="Soft-Delete/Delete Vlan"
          [type]="vlan?.deletedAt ? 'danger' : 'default'"
          (handleClick)="deleteVlan(vlan)"
        ></app-icon-button>
      </section>
    </ng-template>
  </div>
</ng-container>

<app-subnet-modal></app-subnet-modal>
<app-vlan-modal></app-vlan-modal>
<ng-template #loading>
  <fa-icon class="icon" [icon]="['fas', 'spinner']" [animation]="true ? 'spin' : undefined"></fa-icon>
</ng-template>
<app-yes-no-modal [allowEmptyTier]="showRadio"></app-yes-no-modal>
<ng-template #warningMessage>
  <p>Select a Tier to display Subnets & VLANs details</p>
</ng-template>

<ng-template #expandedRows let-vlan="datum">
  <section class="table__expanded-row">
    <app-aci-runtime [vlan]="vlan"></app-aci-runtime>
  </section>
</ng-template>
