<div>
  <h1>Load Balancers</h1>

  <div class="mt-3 mb-3">
    <div class="form-row pb-2">
      <span class="col-form-label mr-2">Tier <tooltip [message]="helpText.Tier"></tooltip>
      </span>
      <select
        name="tier"
        class="form-control col-md-3 mr-1"
        [(ngModel)]="currentTier"
        (ngModelChange)="getObjectsForNavIndex()"
        [disabled]="datacenterService.datacenterLockValue"
        >
        <option *ngFor="let tier of tiers" [ngValue]="tier">{{ tier.name }}</option>
      </select>
    </div>
  </div>

  <ul class="nav nav-tabs">
    <li class="nav-item" (click)="navIndex = 0; getVirtualServers(); getIrules(); getPools()">
      <a class="nav-link" [ngClass]="{ active: navIndex == 0 }">
        Virtual Servers <tooltip [message]="helpText.VirtualServers"></tooltip>
      </a>
    </li>
    <li class="nav-item" (click)="navIndex = 1; getPools(); getHealthMonitors();">
      <a class="nav-link" [ngClass]="{ active: navIndex == 1 }">
        Pools <tooltip [message]="helpText.Pools"></tooltip>
      </a>
    </li>
    <li class="nav-item" (click)="navIndex = 2; getNodes()">
      <a class="nav-link" [ngClass]="{ active: navIndex == 2 }">
        Nodes <tooltip [message]="helpText.Nodes"></tooltip>
      </a>
    </li>
    <li class="nav-item" (click)="navIndex = 3; getIrules()">
      <a class="nav-link" [ngClass]="{ active: navIndex == 3 }">
        iRules <tooltip [message]="helpText.IRules"></tooltip>
      </a>
    </li>
    <li class="nav-item" (click)="navIndex = 4; getHealthMonitors()">
      <a class="nav-link" [ngClass]="{ active: navIndex == 4 }">
        Health Monitors <tooltip [message]="helpText.HealthMonitors"></tooltip>
      </a>
    </li>
  </ul>

  <div *ngIf="navIndex == 0">
    <div class="btn-group-sm mb-2 pull-right mt-3" role="group">
      <button
        type="button"
        class="btn btn-success"
        (click)="openVirtualServerModal('Create')"
        aria-label="Create Virtual Server"
      >
        <fa name="plus"></fa>
        Create Virtual Server
      </button>
    </div>

    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Type</th>
          <th scope="col">Destination Address</th>
          <th scope="col">Service Port</th>
          <th scope="col">Pool</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let virtualServer of virtualServers">
          <td>
            <span>{{ virtualServer?.name }}</span>
          </td>
          <td>
            <span>{{ virtualServer?.type }}</span>
          </td>
          <td>
            <span>{{ virtualServer?.destinationIpAddress }}</span>
          </td>
          <td>
            <span>{{ virtualServer?.servicePort }}</span>
          </td>
          <td>
            <span>{{ virtualServer?.defaultPoolId }}</span>
          </td>
          <td class="item-actions">
            <fa
              name="pencil"
              (click)="openVirtualServerModal('Edit', virtualServer)"
              aria-label="Edit Virtual Server"
            >
            </fa>
            <fa name="undo" *ngIf="virtualServer?.deletedAt" class="fg-success" (click)="restoreVirtualServer(virtualServer)" aria-label="Restore Virtual Server"></fa>
            <fa name="trash" [ngClass]="{ 'fg-danger': virtualServer?.deletedAt }" (click)="deleteVirtualServer(virtualServer)" aria-label="Soft-Delete/Delete Virtual Server"></fa>
          </td>
        </tr>
        <tr *ngIf="virtualServers?.length === 0" class="text-center">
          <td colspan="6">No Virtual Servers in this Tier.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="navIndex == 1">
    <div class="btn-group-sm mb-2 pull-right  mt-3" role="group">
      <button
        type="button"
        class="btn btn-success"
        (click)="openPoolModal('Create')"
        aria-label="Create Pool"
      >
        <fa name="plus"></fa>
        Create Pool
      </button>
    </div>

    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">LB Method</th>
          <th scope="col">Service Port</th>
          <th scope="col">Nodes</th>
          <th scope="col">Health Monitors</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let pool of pools">
          <td>
            <span>{{ pool?.name }}</span>
          </td>
          <td>
            <span>{{ pool?.loadBalancingMethod }}</span>
          </td>
          <td>
            <span>{{ pool?.servicePort }}</span>
          </td>
          <td>
            <span>{{ pool?.nodes?.length }}</span>
          </td>
          <td>
            <span>{{ pool?.healthMonitors?.length }}</span>
          </td>
          <td class="item-actions">
            <fa name="pencil" (click)="openPoolModal('Edit', pool)" aria-label="Edit Pool">
            </fa>
            <fa name="undo" *ngIf="pool?.deletedAt" class="fg-success" (click)="restorePool(pool)" aria-label="Restore Pool"></fa>
            <fa name="trash" [ngClass]="{ 'fg-danger': pool?.deletedAt }" (click)="deletePool(pool)" aria-label="Soft-Delete/Delete Pool"></fa>
          </td>
        </tr>
        <tr *ngIf="!pools?.length" class="text-center">
          <td colspan="5">No Pools in this tier</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="navIndex == 2">
    <div class="btn-group-sm mb-2 pull-right  mt-3" role="group">
      <button
        type="button"
        class="btn btn-success"
        (click)="openNodeModal('Create')"
        aria-label="Create Node"
      >
        <fa name="plus"></fa>
        Create Node
      </button>
    </div>

    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Type</th>
          <th scope="col">Ip Address</th>
          <th scope="col">FQDN</th>
          <th scope="col">Autopopulate</th>
          <th scope="col">Service Port</th>
          <th scope="col">Priority</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let node of nodes">
          <td>
            <span>{{ node?.name }}</span>
          </td>
          <td>
            <span>{{ node?.type }}</span>
          </td>
          <td>
            <span>{{ node?.ipAddress }}</span>
          </td>
          <td>
            <span>{{ node?.fqdn }}</span>
          </td>
          <td>
            <span>{{ node?.autoPopulate }}</span>
          </td>
          <td>
            <span>{{ node?.servicePort }}</span>
          </td>
          <td>
            <span>{{ node?.priority }}</span>
          </td>
          <td class="item-actions">
            <fa name="pencil" (click)="openNodeModal('Edit', node)" aria-label="Edit Node">
            </fa>
            <fa name="undo" *ngIf="node?.deletedAt" class="fg-success" (click)="restoreNode(node)" aria-label="Restore Node"></fa>
            <fa name="trash" [ngClass]="{ 'fg-danger': node?.deletedAt }" (click)="deleteNode(node)" aria-label="Soft-Delete/Delete Node"></fa>
          </td>
        </tr>
        <tr *ngIf="!nodes?.length" class="text-center">
          <td colspan="7">No Nodes in this tier</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="navIndex == 3">
    <div class="btn-group-sm mb-2 pull-right  mt-3" role="group">
      <button
        type="button"
        class="btn btn-success"
        (click)="openIRuleModal('Create')"
        aria-label="Create iRule"
      >
        <fa name="plus"></fa>
        Create iRule
      </button>
    </div>

    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Content</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let irule of irules">
          <td>
            <span>{{ irule?.name }}</span>
          </td>
          <td>
            <span>{{ irule?.content }}</span>
          </td>
          <td class="item-actions">
            <fa
              name="pencil"
              (click)="openIRuleModal('Edit',irule)"
              aria-label="Edit iRule"
            >
            </fa>
            <fa name="undo" *ngIf="irule?.deletedAt" class="fg-success" (click)="restoreIrule(irule)" aria-label="Restore Irule"></fa>
            <fa name="trash" [ngClass]="{ 'fg-danger': irule?.deletedAt }" (click)="deleteIrule(irule)" aria-label="Soft-Delete/Delete Irule"></fa>
          </td>
        </tr>
        <tr *ngIf="!irules?.length" class="text-center">
          <td colspan="2">No iRules in this Tier</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="navIndex == 4">
    <div class="btn-group-sm mb-2 pull-right mt-3" role="group">
      <button
        type="button"
        class="btn btn-success"
        (click)="openHealthMonitorModal('Create')"
        aria-label="Create Health Monitor"
      >
        <fa name="plus"></fa>
        Create Health Monitor
      </button>
    </div>

    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Type</th>
          <th scope="col">Service Port</th>
          <th scope="col">Interval</th>
          <th scope="col">Timeout</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let healthMonitor of healthMonitors">
          <td>
            <span>{{ healthMonitor?.name }}</span>
          </td>
          <td>
            <span>{{ healthMonitor?.type }}</span>
          </td>
          <td>
            <span>{{ healthMonitor?.servicePort }}</span>
          </td>
          <td>
            <span>{{ healthMonitor?.interval }}</span>
          </td>
          <td>
            <span>{{ healthMonitor?.timeout }}</span>
          </td>
          <td class="item-actions">
            <fa
              name="pencil"
              (click)="editHealthMonitor(healthMonitor)"
              (click)="openHealthMonitorModal('Edit', healthMonitor)"
              aria-label="Edit Health Monitor"
            >
            </fa>
            <fa name="undo" *ngIf="healthMonitor?.deletedAt" class="fg-success" (click)="restoreHealthMonitor(healthMonitor)" aria-label="Restore Health Monitor"></fa>
            <fa name="trash" [ngClass]="{ 'fg-danger': healthMonitor?.deletedAt }" (click)="deleteHealthMonitor(healthMonitor)"
              aria-label="Soft-Delete/Delete Health Monitor"></fa>
          </td>
        </tr>
        <tr *ngIf="!healthMonitors?.length" class="text-center">
          <td colspan="6">No Health Monitors in this Tier</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="currentTier" class="pull-right">
    <!-- <app-import-export
      [exportObject]="exportLoadBalancerConfig()"
      exportFileName="loadBalancers-{{ currentTier.name }}"
      disableCsv="true"
      (import)="importLoadBalancerConfig($event)"
    ></app-import-export> -->
  </div>

  <app-virtual-server-modal></app-virtual-server-modal>
  <app-pool-modal></app-pool-modal>
  <app-node-modal></app-node-modal>
  <app-irule-modal></app-irule-modal>
  <app-health-monitor-modal></app-health-monitor-modal>
</div>
<app-yes-no-modal></app-yes-no-modal>
