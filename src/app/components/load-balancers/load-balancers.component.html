<div>
  <h1>Load Balancers</h1>

  <div class="mt-3 mb-3">
    <div class="form-row pb-2">
      <span class="col-form-label mr-2">VRF</span>
      <select
        name="vrf"
        class="form-control col-md-3 mr-1"
        [(ngModel)]="currentVrf"
        (ngModelChange)="getVrfObjects(currentVrf)"
        [disabled]="dirty"
      >
        <option *ngFor="let vrf of vrfs" [ngValue]="vrf">{{ vrf.name }}</option>
      </select>

      <div class="button-group btn-group-sm ml-auto">
        <button
          type="button"
          class="btn btn-success mr-1"
          aria-label="Save Changes to Current VRF"
          (click)="saveAll()"
          [hidden]="!dirty"
        >
          <fa name="save"></fa>
          Save Changes to Current Tier (VRF)
        </button>
        <button
          type="button"
          class="btn btn-danger mr-1"
          aria-label="Clear Changes to Current VRF"
          (click)="getVrfs()"
          [hidden]="!dirty"
        >
          <fa name="trash"></fa>
          Clear Changes to Current Tier (VRF)
        </button>
      </div>
    </div>
  </div>

  <ul class="nav nav-tabs">
    <li class="nav-item" (click)="navIndex = 0">
      <a class="nav-link" [ngClass]="{ active: navIndex == 0 }"
        >Virtual Servers</a
      >
    </li>
    <li class="nav-item" (click)="navIndex = 1">
      <a class="nav-link" [ngClass]="{ active: navIndex == 1 }">Pools</a>
    </li>
    <li class="nav-item" (click)="navIndex = 2">

      <a class="nav-link" [ngClass]="{ active: navIndex == 2 }">iRules</a>
      <span tooltip="F5 LoadBalancer language" placement="center" container="body"><fa name="question-circle-o"></fa></span>
    </li>
    <li class="nav-item" (click)="navIndex = 3">
      <a class="nav-link" [ngClass]="{ active: navIndex == 3 }"
        >Health Monitors</a
      >
    </li>
  </ul>

  <div *ngIf="navIndex == 0">
    <div class="btn-group-sm mb-2 pull-right mt-3" role="group">
      <button
        type="button"
        class="btn btn-success"
        (click)="createVirtualServer()"
        aria-label="Create Virtual Server"
      >
        <fa name="plus"></fa>
        Create Virtual Server
      </button>
    </div>

    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Type</th>
          <th scope="col">Destination Address</th>
          <th scope="col">Service Port</th>
          <th scope="col">Pool</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let virtualServer of virtualServers">
          <td>
            <span>{{ virtualServer.Name }}</span>
          </td>
          <td>
            <span>{{ virtualServer.Type }}</span>
          </td>
          <td>
            <span>{{ virtualServer.DestinationAddress }}</span>
          </td>
          <td>
            <span>{{ virtualServer.ServicePort }}</span>
          </td>
          <td>
            <span>{{ virtualServer.Pool }}</span>
          </td>
          <td class="item-actions">
            <fa
              name="pencil"
              (click)="editVirtualServer(virtualServer)"
              aria-label="Edit Virtual Server"
            >
            </fa>
            <fa name="trash" (click)="deleteVirtualServer(virtualServer)"> </fa>
          </td>
        </tr>
        <tr *ngIf="virtualServers?.length === 0" class="text-center">
          <td colspan="6">No Virtual Servers in this VRF.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="navIndex == 1">
    <div class="btn-group-sm mb-2 pull-right  mt-3" role="group">
      <button
        type="button"
        class="btn btn-success"
        (click)="createPool()"
        aria-label="Create Pool"
      >
        <fa name="plus"></fa>
        Create Pool
      </button>
    </div>

    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">LB Method</th>
          <th scope="col">Pool Members</th>
          <th scope="col">Health Monitors</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let pool of pools">
          <td>
            <span>{{ pool.Name }}</span>
          </td>
          <td>
            <span>{{ pool.LoadBalancingMethod }}</span>
          </td>
          <td>
            <span>{{ pool.Members?.length }}</span>
          </td>
          <td>
            <span>{{ pool.HealthMonitors?.length }}</span>
          </td>
          <td class="item-actions">
            <fa name="pencil" (click)="editPool(pool)" aria-label="Edit Pool">
            </fa>
            <fa
              name="trash"
              (click)="deletePool(pool)"
              aria-label="Delete Pool"
            >
            </fa>
          </td>
        </tr>
        <tr *ngIf="!pools?.length" class="text-center">
          <td colspan="5">No Pools in this VRF</td>
        </tr>
      </tbody>
    </table>
  </div>
  <!-- </div> -->

  <div *ngIf="navIndex == 2">
    <div class="btn-group-sm mb-2 pull-right  mt-3" role="group">
      <button
        type="button"
        class="btn btn-success"
        (click)="createIRule()"
        aria-label="Create iRule"
      >
        <fa name="plus"></fa>
        Create iRule
      </button>
    </div>

    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let irule of irules">
          <td>
            <span>{{ irule.Name }}</span>
          </td>
          <td class="item-actions">
            <fa
              name="pencil"
              (click)="editIRule(irule)"
              aria-label="Edit iRule"
            >
            </fa>
            <fa
              name="trash"
              (click)="deleteIRule(irule)"
              aria-label="Delete iRule"
            >
            </fa>
          </td>
        </tr>
        <tr *ngIf="!irules?.length" class="text-center">
          <td colspan="2">No iRules in this VRF</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="navIndex == 3">
    <div class="btn-group-sm mb-2 pull-right mt-3" role="group">
      <button
        type="button"
        class="btn btn-success"
        (click)="createHealthMonitor()"
        aria-label="Create Health Monitor"
      >
        <fa name="plus"></fa>
        Create Health Monitor
      </button>
    </div>

    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Type</th>
          <th scope="col">Service Port</th>
          <th scope="col">Interval</th>
          <th scope="col">Timeout</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let healthMonitor of healthMonitors">
          <td>
            <span>{{ healthMonitor.Name }}</span>
          </td>
          <td>
            <span>{{ healthMonitor.Type }}</span>
          </td>
          <td>
            <span>{{ healthMonitor.ServicePort }}</span>
          </td>
          <td>
            <span>{{ healthMonitor.Interval }}</span>
          </td>
          <td>
            <span>{{ healthMonitor.Timeout }}</span>
          </td>
          <td class="item-actions">
            <fa
              name="pencil"
              (click)="editHealthMonitor(healthMonitor)"
              aria-label="Edit Health Monitor"
            >
            </fa>
            <fa
              name="trash"
              (click)="deleteHealthMonitor(healthMonitor)"
              aria-label="Delete Health Monitor"
            >
            </fa>
          </td>
        </tr>
        <tr *ngIf="!healthMonitors?.length" class="text-center">
          <td colspan="6">No Health Monitors in this VRF</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="currentVrf" class="pull-right">
    <app-import-export
      [exportObject]="exportLoadBalancerConfig()"
      exportFileName="loadBalancers-{{ currentVrf.name }}"
      disableCsv="true"
      (import)="importLoadBalancerConfig($event)"
    ></app-import-export>
  </div>

  <app-virtual-server-modal></app-virtual-server-modal>
  <app-pool-modal></app-pool-modal>
  <app-pool-member-modal></app-pool-member-modal>
  <app-irule-modal></app-irule-modal>
  <app-health-monitor-modal></app-health-monitor-modal>
</div>
