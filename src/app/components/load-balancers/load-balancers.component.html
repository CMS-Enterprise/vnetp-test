<app-tier-select></app-tier-select>

<h1>Load Balancers</h1>

<ng-container *ngIf="currentTier">
  <app-tabs [tabs]="tabs" (tabChange)="handleTabChange($event)"></app-tabs>

  <div *ngIf="navIndex === 0">
    <app-virtual-server-list [currentTier]="currentTier" [datacenterId]="datacenterId" [tiers]="tiers"></app-virtual-server-list>
  </div>

  <div *ngIf="navIndex === 1">
    <section class="btn-toolbar" role="toolbar">
      <!-- Create Pool -->
      <button type="button" class="btn btn-success" (click)="openPoolModal(ModalMode.Create)">
        <fa-icon class="icon" [icon]="['fas', 'plus']"></fa-icon>
        <span>Create Pool</span>
      </button>
    </section>

    <table class="table table-striped">
      <caption>
        <fa-icon class="icon" [icon]="['fas', 'table']"></fa-icon>
        <span>Manage Pools</span>
      </caption>
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">LB Method</th>
          <th scope="col">Nodes</th>
          <th scope="col">Health Monitors</th>
          <th scope="col">State</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let pool of pools | paginate: { itemsPerPage: perPage, currentPage: currentPoolPage }">
          <td>
            <span>{{ pool?.name }}</span>
          </td>
          <td>
            <span>{{ pool?.loadBalancingMethod }}</span>
          </td>
          <td>
            <span>{{ pool?.nodes?.length }}</span>
          </td>
          <td>
            <span>{{ pool?.healthMonitors?.length + pool?.defaultHealthMonitors?.length }}</span>
          </td>
          <td>
            <span>{{ pool?.provisionedAt ? 'Provisioned' : 'Not Provisioned' }}</span>
          </td>
          <td class="table__actions">
            <app-icon-button
              *ngIf="!pool?.deletedAt"
              icon="edit"
              label="Edit Pool"
              (handleClick)="openPoolModal(ModalMode.Edit, pool)"
            ></app-icon-button>

            <app-icon-button
              *ngIf="pool?.deletedAt"
              icon="undo"
              label="Restore Pool"
              type="success"
              (handleClick)="restorePool(pool)"
            ></app-icon-button>

            <app-icon-button
              icon="delete"
              label="Soft-Delete/Delete Pool"
              [type]="pool?.deletedAt ? 'danger' : 'default'"
              (handleClick)="deletePool(pool)"
            ></app-icon-button>
          </td>
        </tr>
        <tr *ngIf="!pools?.length" class="text-center">
          <td colspan="6">No Pools in this tier</td>
        </tr>
      </tbody>
    </table>
    <pagination-controls (pageChange)="currentPoolPage = $event"></pagination-controls>
  </div>

  <div *ngIf="navIndex === 2">
    <label class="mt-3 ml-3">Click the import CSV button to add pool relations</label>
  </div>

  <div *ngIf="navIndex === 3">
    <app-node-list [currentTier]="currentTier" [tiers]="tiers"></app-node-list>
  </div>

  <div *ngIf="navIndex === 4">
    <app-irule-list [currentTier]="currentTier" [tiers]="tiers"></app-irule-list>
  </div>

  <div *ngIf="navIndex === 5">
    <app-health-monitor-list [currentTier]="currentTier" [tiers]="tiers"></app-health-monitor-list>
  </div>

  <div *ngIf="navIndex === 6">
    <app-profile-list [currentTier]="currentTier" [tiers]="tiers"></app-profile-list>
  </div>

  <div *ngIf="navIndex === 7">
    <section class="btn-toolbar" role="toolbar">
      <!-- Create Policy -->
      <button type="button" class="btn btn-success" (click)="openPolicyModal(ModalMode.Create)">
        <fa-icon class="icon" [icon]="['fas', 'plus']"></fa-icon>
        <span>Create Policy</span>
      </button>
    </section>

    <table class="table table-striped">
      <caption>
        <fa-icon class="icon" [icon]="['fas', 'table']"></fa-icon>
        <span>Manage Policies</span>
      </caption>
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Type</th>
          <th scope="col">State</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let policy of policies | paginate: { itemsPerPage: perPage, currentPage: currentPoliciesPage }">
          <td>
            <span>{{ policy?.name }}</span>
          </td>
          <td>
            <span>{{ policy?.type }}</span>
          </td>
          <td>
            <span>{{ policy?.provisionedAt ? 'Provisioned' : 'Not Provisioned' }}</span>
          </td>
          <td class="table__actions">
            <app-icon-button
              *ngIf="!policy?.deletedAt"
              icon="edit"
              label="Edit Policy"
              (handleClick)="openPolicyModal(ModalMode.Edit, policy)"
            ></app-icon-button>

            <app-icon-button
              *ngIf="policy?.deletedAt"
              icon="undo"
              label="Restore Policy"
              type="success"
              (handleClick)="restorePolicy(policy)"
            ></app-icon-button>

            <app-icon-button
              icon="delete"
              label="Soft-Delete/Delete Policy"
              [type]="policy?.deletedAt ? 'danger' : 'default'"
              (handleClick)="deletePolicy(policy)"
            ></app-icon-button>
          </td>
        </tr>
        <tr *ngIf="!policies?.length" class="text-center">
          <td colspan="4">No Policies in this Tier</td>
        </tr>
      </tbody>
    </table>
    <pagination-controls (pageChange)="currentPoliciesPage = $event"></pagination-controls>
  </div>

  <div *ngIf="navIndex === 8">
    <app-vlan-list [currentTier]="currentTier" [tiers]="tiers"></app-vlan-list>
  </div>

  <div *ngIf="navIndex === 9">
    <app-self-ip-list [currentTier]="currentTier" [tiers]="tiers"></app-self-ip-list>
  </div>

  <div *ngIf="navIndex === 10">
    <app-route-list [currentTier]="currentTier" [tiers]="tiers"></app-route-list>
  </div>

  <section class="btn-toolbar btn-toolbar--start" role="toolbar" *ngIf="enablePerPage()">
    <span class="mr-3">Entities per page</span>
    <div class="btn-group" role="group">
      <button type="button" value="10" (click)="perPage = $event.target.value" class="btn btn-light">10</button>
      <button type="button" value="20" (click)="perPage = $event.target.value" class="btn btn-light">20</button>
      <button type="button" value="50" (click)="perPage = $event.target.value" class="btn btn-light">50</button>
    </div>
  </section>

  <section class="btn-toolbar" role="toolbar" *ngIf="currentTier">
    <app-import-export
      [disableImport]="disableImport()"
      [disableExport]="disableExport()"
      [exportObject]="exportLoadBalancerConfig()"
      exportFileName="loadBalancers-{{ currentTier.name }}"
      (import)="importLoadBalancerConfig($event)"
    ></app-import-export>
  </section>
</ng-container>

<app-pool-modal></app-pool-modal>
<app-load-balancer-policy-modal></app-load-balancer-policy-modal>
<app-yes-no-modal></app-yes-no-modal>
