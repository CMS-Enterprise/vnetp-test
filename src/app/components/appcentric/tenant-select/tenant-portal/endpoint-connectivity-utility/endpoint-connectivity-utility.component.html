<div class="container">
  <div class="header">
    <h1>Endpoint Connectivity Utility</h1>
  </div>

  <div class="content">
    <!-- Connectivity Test Form -->
    <div class="connectivity-form">
      <h2>Test Endpoint Connectivity</h2>

      <form [formGroup]="connectivityForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="sourceEndpointIp">Source IP</label>
          <input type="text" id="sourceEndpointIp" formControlName="sourceEndpointIp" placeholder="e.g. 10.0.0.1" />
          <div class="error" *ngIf="connectivityForm.get('sourceEndpointIp')?.invalid && connectivityForm.get('sourceEndpointIp')?.touched">
            Please enter a valid IP address
          </div>
        </div>

        <div class="form-group">
          <label for="sourceEndpointPort">Source Port (Optional)</label>
          <input type="number" id="sourceEndpointPort" formControlName="sourceEndpointPort" placeholder="e.g. 80" />
        </div>

        <div class="form-group">
          <label for="destinationEndpointIp">Destination IP</label>
          <input type="text" id="destinationEndpointIp" formControlName="destinationEndpointIp" placeholder="e.g. 10.0.0.2" />
          <div
            class="error"
            *ngIf="connectivityForm.get('destinationEndpointIp')?.invalid && connectivityForm.get('destinationEndpointIp')?.touched"
          >
            Please enter a valid IP address
          </div>
        </div>

        <div class="form-group">
          <label for="destinationEndpointPort">Destination Port</label>
          <input type="number" id="destinationEndpointPort" formControlName="destinationEndpointPort" placeholder="e.g. 443" />
          <div
            class="error"
            *ngIf="connectivityForm.get('destinationEndpointPort')?.invalid && connectivityForm.get('destinationEndpointPort')?.touched"
          >
            Please enter a valid port number
          </div>
        </div>

        <div class="form-group">
          <label for="ipProtocol">Protocol</label>
          <select id="ipProtocol" formControlName="ipProtocol">
            <option *ngFor="let protocol of protocolOptions" [value]="protocol">
              {{ protocol.toUpperCase() }}
            </option>
          </select>
        </div>

        <div class="form-options">
          <div class="checkbox-group">
            <input type="checkbox" id="bypassServiceGraph" formControlName="bypassServiceGraph" />
            <label for="bypassServiceGraph">Bypass Service Graph</label>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="generateConfig" formControlName="generateConfig" />
            <label for="generateConfig">Generate Configuration</label>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="applyConfig" formControlName="applyConfig" />
            <label for="applyConfig">Apply Configuration</label>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="bidirectional" formControlName="bidirectional" />
            <label for="bidirectional">Test Bidirectional</label>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="resetForm()">Reset</button>
          <button type="submit" class="btn btn-primary" [disabled]="connectivityForm.invalid || isLoading">
            {{ isLoading ? 'Testing...' : 'Test Connectivity' }}
          </button>
        </div>
      </form>
    </div>

    <!-- Result Summary -->
    <div *ngIf="connectivityResult" class="result-summary">
      <h2>Connectivity Test Result</h2>
      <div class="result-info">
        <div class="result-item">
          <span class="result-label">Control Plane:</span>
          <span
            class="result-value"
            [ngClass]="{
              'status-allowed': connectivityResult.controlPlaneAllowed === true,
              'status-denied': connectivityResult.controlPlaneAllowed === false,
              'status-unknown': connectivityResult.controlPlaneAllowed === undefined
            }"
          >
            {{
              connectivityResult.controlPlaneAllowed === true
                ? '‚úì Allowed'
                : connectivityResult.controlPlaneAllowed === false
                  ? '‚úó Denied'
                  : 'Unknown'
            }}
          </span>
        </div>
        <div class="result-item" *ngIf="connectivityResult.controlPath">
          <span class="result-label">Control Path:</span>
          <span class="result-value">{{ connectivityResult.controlPath.hopCount }} hops, cost {{ connectivityResult.controlPath.totalCost }}</span>
        </div>
        <div class="result-item" *ngIf="connectivityResult.dataPath">
          <span class="result-label">Data Path:</span>
          <span class="result-value">{{ connectivityResult.dataPath.hopCount }} hops, cost {{ connectivityResult.dataPath.totalCost }}</span>
        </div>
        <div class="result-item" *ngIf="connectivityResult.queryOutdated" class="warning">
          <span class="result-label">Warning:</span>
          <span class="result-value">Query is outdated. Tenant version has changed. Please refresh the graph.</span>
        </div>
      </div>
    </div>

    <!-- Graph Visualization -->
    <div class="graph-section">
      <h2>Tenant Graph Visualization</h2>

      <!-- Graph Loading State -->
      <div *ngIf="isGraphLoading" class="graph-loading">
        <div class="spinner"></div>
        <div class="loading-text">Loading tenant graph...</div>
      </div>

      <!-- Graph Error State -->
      <div *ngIf="graphError && !isGraphLoading" class="graph-error">
        <div class="error-icon">‚ö†Ô∏è</div>
        <div class="error-text">{{ graphError }}</div>
      </div>

      <!-- Graph Container -->
      <div *ngIf="graph && !isGraphLoading && !graphError" id="endpointGraphContainer" class="graph-container">
        <svg id="endpointGraphSvg" class="graph-svg"></svg>
      </div>

      <!-- No Graph State -->
      <div *ngIf="!graph && !isGraphLoading && !graphError" class="graph-placeholder">
        <div class="placeholder-icon">üìä</div>
        <div class="placeholder-text">Graph will load automatically</div>
      </div>
    </div>
  </div>
</div>
