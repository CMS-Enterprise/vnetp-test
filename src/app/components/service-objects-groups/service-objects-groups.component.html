<app-tier-select></app-tier-select>

<h1>Service Objects & Groups</h1>
<ng-container *ngIf="currentTier; else warningMessage">
  <app-tabs [tabs]="tabs" (tabChange)="handleTabChange($event)"></app-tabs>

  <div *ngIf="navIndex === 0">
    <section class="btn-toolbar" role="toolbar">
      <!-- Create Service Object -->
      <button type="button" class="btn btn-success" (click)="openServiceObjectModal(ModalMode.Create)">
        <fa-icon class="icon" [icon]="['fas', 'plus']"></fa-icon>
        <span>Create Service Object</span>
      </button>
    </section>

    <table class="table table-striped">
      <caption>
        <fa-icon class="icon" [icon]="['fas', 'table']"></fa-icon>
        <span>Service Objects consist of source and destination ports</span>
      </caption>
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Type</th>
          <th scope="col">Source Port</th>
          <th scope="col">Destination Port</th>
          <th scope="col">State</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let svcObj of serviceObjects | paginate: { itemsPerPage: perPage, currentPage: currentServiceObjectsPage }">
          <td>
            <span>{{ svcObj?.name | slice: 0:20 }}{{ svcObj?.name.length > 20 ? '...' : '' }}</span>
          </td>
          <td>
            <span>{{ svcObj?.protocol }}</span>
          </td>
          <td>
            <span>{{ svcObj?.sourcePorts }}</span>
          </td>
          <td>
            <span>{{ svcObj?.destinationPorts }}</span>
          </td>
          <td>
            <span>{{ svcObj?.provisionedAt ? 'Provisioned' : 'Not Provisioned' }}</span>
          </td>
          <td class="table__actions">
            <app-icon-button
              *ngIf="!svcObj?.deletedAt"
              icon="edit"
              label="Edit Service Object"
              (handleClick)="openServiceObjectModal(ModalMode.Edit, svcObj)"
            ></app-icon-button>

            <app-icon-button
              *ngIf="svcObj?.deletedAt"
              icon="undo"
              label="Restore Service Object"
              type="success"
              (handleClick)="restoreServiceObject(svcObj)"
            ></app-icon-button>

            <app-icon-button
              icon="delete"
              label="Soft-Delete/Delete Service Object"
              [type]="svcObj?.deletedAt ? 'danger' : 'default'"
              (handleClick)="deleteServiceObject(svcObj)"
            ></app-icon-button>
          </td>
        </tr>
        <tr *ngIf="!serviceObjects?.length" class="text-center">
          <td colspan="6">No Service Objects in this Tier</td>
        </tr>
      </tbody>
    </table>
    <pagination-controls (pageChange)="currentServiceObjectsPage = $event"></pagination-controls>
  </div>

  <div *ngIf="navIndex === 1">
    <section class="btn-toolbar" role="toolbar">
      <!-- Create Service Object Group -->
      <button type="button" class="btn btn-success" (click)="openServiceObjectGroupModal(ModalMode.Create)">
        <fa-icon class="icon" [icon]="['fas', 'plus']"></fa-icon>
        <span>Create Service Object Group</span>
      </button>
    </section>

    <table class="table table-striped">
      <caption>
        <fa-icon class="icon" [icon]="['fas', 'table']"></fa-icon>
        <span>Service Object Groups are a collection of Service Objects</span>
      </caption>
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Type</th>
          <th scope="col">Members</th>
          <th scope="col">State</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="
            let svcObjGroup of serviceObjectGroups
              | paginate
                : {
                    itemsPerPage: perPage,
                    currentPage: currentServiceObjectGroupsPage
                  }
          "
        >
          <td>
            <span>{{ svcObjGroup.name | slice: 0:20 }}{{ svcObjGroup.name.length > 20 ? '...' : '' }}</span>
          </td>
          <td>
            <span>{{ svcObjGroup.type }}</span>
          </td>
          <td>
            <span>{{ svcObjGroup.serviceObjects?.length }}</span>
          </td>
          <td>
            <span>{{ svcObjGroup.provisionedAt ? 'Provisioned' : 'Not Provisioned' }}</span>
          </td>
          <td class="table__actions">
            <app-icon-button
              *ngIf="!svcObjGroup?.deletedAt"
              icon="edit"
              label="Edit Service Object Group"
              (handleClick)="openServiceObjectGroupModal(ModalMode.Edit, svcObjGroup)"
            ></app-icon-button>

            <app-icon-button
              *ngIf="svcObjGroup?.deletedAt"
              icon="undo"
              label="Restore Service Object Group"
              type="success"
              (handleClick)="restoreServiceObjectGroup(svcObjGroup)"
            ></app-icon-button>

            <app-icon-button
              icon="delete"
              label="Soft-Delete/Delete Service Object Group"
              [type]="svcObjGroup?.deletedAt ? 'danger' : 'default'"
              (handleClick)="deleteServiceObjectGroup(svcObjGroup)"
            ></app-icon-button>
          </td>
        </tr>
        <tr *ngIf="!serviceObjectGroups?.length" class="text-center">
          <td colspan="5">No Service Object Groups in this Tier</td>
        </tr>
      </tbody>
    </table>
    <pagination-controls (pageChange)="currentServiceObjectGroupsPage = $event"></pagination-controls>
  </div>

  <div *ngIf="navIndex === 2">
    <label class="mt-3 ml-3">Click the import CSV button to add Service Object Group relations</label>
  </div>

  <section class="btn-toolbar btn-toolbar--start" role="toolbar" *ngIf="navIndex !== 2">
    <span class="mr-3">Entities per page</span>
    <div class="btn-group" role="group">
      <button type="button" value="10" (click)="perPage = $event.target.value" class="btn btn-light">10</button>
      <button type="button" value="20" (click)="perPage = $event.target.value" class="btn btn-light">20</button>
      <button type="button" value="50" (click)="perPage = $event.target.value" class="btn btn-light">50</button>
    </div>
  </section>

  <section class="btn-toolbar" role="toolbar" *ngIf="navIndex === 0">
    <app-import-export
      [exportObject]="serviceObjects"
      exportFileName="serviceObjects-{{ currentTier?.name }}"
      [disableJson]="false"
      (import)="importServiceObjectsConfig($event)"
    ></app-import-export>
  </section>

  <section class="btn-toolbar" role="toolbar" *ngIf="navIndex === 1">
    <app-import-export
      [exportObject]="serviceObjectGroups"
      exportFileName="serviceObjectGroups-{{ currentTier?.name }}"
      [disableJson]="false"
      (import)="importServiceObjectGroupsConfig($event)"
    ></app-import-export>
  </section>

  <section class="btn-toolbar" role="toolbar" *ngIf="navIndex === 2">
    <app-import-export
      [disableExport]="true"
      [disableJson]="false"
      (import)="importServiceObjectGroupRelationsConfig($event)"
    ></app-import-export>
  </section>
</ng-container>
<app-service-object-group-modal></app-service-object-group-modal>
<app-service-object-modal></app-service-object-modal>
<app-yes-no-modal [allowEmptyTier]="showRadio"></app-yes-no-modal>
<ng-template #warningMessage>
  <p>Select a Tier to display Service Objects & Groups details</p>
</ng-template>
